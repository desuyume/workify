{
    email 77desss@gmail.com
}

www.{$DOMAIN_NAME} {
    redir https://{$DOMAIN_NAME}{uri}
}

{$DOMAIN_NAME} {
    encode gzip
    reverse_proxy frontend:{$FRONTEND_PORT}
}

api.{$DOMAIN_NAME} {
    encode gzip
    
    header {
        Access-Control-Allow-Origin "https://{$DOMAIN_NAME}"
        Access-Control-Allow-Methods "GET,POST,PUT,DELETE,OPTIONS"
        Access-Control-Allow-Credentials "true"
        Access-Control-Allow-Headers "*"
    }
    
    @preflight method OPTIONS
    handle @preflight {
        header Access-Control-Allow-Origin "https://{$DOMAIN_NAME}"
        header Access-Control-Allow-Methods "GET,POST,PUT,DELETE,OPTIONS"
        header Access-Control-Allow-Credentials "true"
        header Access-Control-Allow-Headers "*"
        respond 204
    }
    
    handle {
        reverse_proxy backend:{$BACKEND_PORT}
    }
}

admin.{$DOMAIN_NAME} {
    encode gzip
    
    route {
        authenticate with admin_auth
        reverse_proxy adminer:8080
    }
}

monitor.{$DOMAIN_NAME} {
    encode gzip
    
    route /prometheus/* {
        authenticate with monitor_auth
        reverse_proxy prometheus:9090
    }
    
    route {
        authenticate with monitor_auth
        reverse_proxy grafana:3001
    }
}

(admin_auth) {
    basic_auth {
        realm "Admin Area"
        {$ADMIN_USER} {$ADMIN_PASSWORD}
    }
}

(monitor_auth) {
    basic_auth {
        realm "Monitoring"
        {$MONITOR_USER} {$MONITOR_PASSWORD}
    }
}
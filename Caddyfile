{
    email 77desss@gmail.com
}

www.{$DOMAIN_NAME} {
    redir https://{$DOMAIN_NAME}{uri}
}

{$DOMAIN_NAME} {
    encode gzip
    reverse_proxy frontend:{$FRONTEND_PORT}
}

api.{$DOMAIN_NAME} {
    encode gzip
    
    @preflight method OPTIONS
    handle @preflight {
        header Access-Control-Allow-Origin "https://{$DOMAIN_NAME}"
        header Access-Control-Allow-Methods "GET,POST,PUT,DELETE,OPTIONS,PATCH"
        header Access-Control-Allow-Credentials "true"
        header Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With, Accept, Origin"
        respond 204
    }
    
    handle {
        header Access-Control-Allow-Origin "https://{$DOMAIN_NAME}"
        header Access-Control-Allow-Credentials "true"
        reverse_proxy backend:{$BACKEND_PORT}
    }
}

admin.{$DOMAIN_NAME} {
    encode gzip
    
    basicauth {
        {$ADMIN_USER} {$ADMIN_PASSWORD}
    }
    reverse_proxy adminer:8080
}

monitor.{$DOMAIN_NAME} {
    encode gzip
    
    handle /prometheus/* {
        basicauth {
            {$MONITOR_USER} {$MONITOR_PASSWORD}
        }
        reverse_proxy prometheus:9090
    }
    
    handle {
        basicauth {
            {$MONITOR_USER} {$MONITOR_PASSWORD}
        }
        reverse_proxy grafana:3001
    }
}